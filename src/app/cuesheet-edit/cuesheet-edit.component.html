<!-- Modal for confirmation of cuesheet deletion -->
<div class="modal fade" id="cuesheetDeletionModal" tabindex="-1" role="dialog"
     aria-labelledby="cuesheetDeletionModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="cuesheetDeletionModalLabel">Are you sure?</h4>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this entire cue sheet?<br>This action cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default modal-btn-dismiss" data-dismiss="modal">No!!! Don't delete
          anything!
        </button>
        <button type="button" class="btn btn-primary modal-btn-delete" data-dismiss="modal" (click)="deleteCuesheet()">
          Yes, delete this cue sheet
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal for confirmation of cue deletion -->
<div class="modal fade" id="cueDeletionModal" tabindex="-1" role="dialog" aria-labelledby="cueDeletionModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close">
          <span aria-hidden="true" class="close-modal">&times;</span>
        </button>
        <h4 class="modal-title" id="cueDeletionModalLabel">Are you sure you want to delete this cue?</h4>
      </div>
      <div class="modal-footer">
        <button type="button"
                class="btn btn-default modal-btn-dismiss"
                data-dismiss="modal">No, don't delete!
        </button>
        <button type="button"
                (click)="deleteCue()"
                class="btn btn-primary modal-btn-delete"
                data-dismiss="modal">Yes, delete this cue.
        </button>
      </div>
    </div>
  </div>
</div>


<div class="container">
  <div class="row">
    <div class="col-sm-12">

      <h1 class="w-100">{{ cuesheet?.name }}
        <button type="button"
                [disabled]="!distance.pristine || !turn.pristine || !description.pristine || insertBeforeId"
                class="right btn btn-primary btn-sm"
                data-toggle="modal"
                data-target="#cuesheetDeletionModal">Delete this cuesheet
        </button>
      </h1>
      <h4>{{ cuesheet?.description }}</h4>
      <span>Created by {{ cuesheet?._creator.fname }} {{ cuesheet?._creator.lname }}</span>
      <span *ngIf="cuesheet?.cues.length > 0">
      <hr>
      <p>Click in any field below to edit it.</p>
      </span>

      <form name="form" (ngSubmit)="syncModel() && f.form.valid && saveCuesheet()" #f="ngForm" novalidate>

        <table class="table table-striped table-bordered">
          <thead>
          <!-- Box around high-lighted table row -->
          <tr id="highlighted-box" class="hide"></tr>
          <tr>
            <th class="col-xs-1">Cue</th>
            <th class="col-xs-2">Distance</th>
            <th class="col-xs-1">Turn</th>
            <th class="col-xs-5">Description</th>
            <th class="col-xs-1">Total</th>
            <th class="col-xs-1"></th>
          </tr>
          </thead>
          <tbody>

          <!-- Existing cues -->
          <tr *ngFor="let cue of cuesheet?.cues; index as i"
              [@cueState]="cue.state"
              class="cue-row"
              id="cue-row-{{ i }}"
          >
            <td>{{ i + 1 }}</td>
            <td>{{ cue.distance / 100 | number:'1.0-2' }}</td>
            <td>{{ cue.turn }}</td>
            <td>{{ cue.description }}</td>
            <td>{{ cue.total / 100 | number:'1.0-2'}}</td>
            <td class="buttons-column">
              <button
                  type="button"
                  data-toggle="modal"
                  data-target="#cueDeletionModal"
                  (click)="prepareToDeleteCue(i)"
                  [disabled]="!distance.pristine || !turn.pristine || !description.pristine || insertBeforeId"
                  class="btn btn-danger btn-xs btn-circle"
                  tooltip="Delete this cue"
                  placement="right">
                <i class="glyphicon glyphicon-remove"></i>
              </button>

              <span class="insert-button-container">
                <button
                    type="button"
                    (click)="insertCue(i)"
                    [disabled]="!distance.pristine || !turn.pristine || !description.pristine || insertBeforeId"
                    class="btn btn-success btn-xs btn-circle insert-button"
                    tooltip="Insert cue here"
                    placement="right">
                  <i class="glyphicon glyphicon-plus"></i>
                </button>
              </span>
            </td>
          </tr>

          <!-- New cue -->
          <tr id="new-cue-row">
            <td>

            </td>
            <td>
              <input type="number" class="form-control" name="distance" id="distance" placeholder="Miles" step=".01"
                     [(ngModel)]="model.distance" #distance="ngModel" required/>
            </td>
            <td>
              <input type="text" class="form-control" name="turn" id="turn" placeholder="Turn" [(ngModel)]="model.turn"
                     #turn="ngModel" required/>
            </td>
            <td>
              <input type="text" class="form-control" name="description" id="description" placeholder="Description"
                     [(ngModel)]="model.description" #description="ngModel" required>
            </td>
            <td>
              <button type="button" class="btn btn-danger btn-block"
                      [disabled]="distance.pristine && turn.pristine && description.pristine && !insertBeforeId"
                      (click)="cancel(); f.reset()">Cancel
              </button>

            </td>
            <td>
              <button type="button"
                      (click)="saveCue(); f.reset()"
                      [disabled]="!f.form.valid"
                      class="btn btn-primary btn-block">Save Cue
              </button>
            </td>

          </tr>

          </tbody>
        </table>

        <div class="row">
          <div class="col-sm-6">
            <button type="button"
                    [disabled]="!distance.pristine || !turn.pristine || !description.pristine || insertBeforeId"
                    routerLink='/cuesheets/{{cuesheet?._id}}/view'
                    class='btn btn-primary btn-block'>I'm done with this cue sheet for now
            </button>
          </div>
        </div>

      </form>

    </div>
  </div>
</div>